// room script file

function ExplodeBox(Object *MyBox, int BoxX, int BoxY)
{
  oDynomite.SetView(27);
  oDynomite.Animate(0, 5, eOnce, eBlock);
  MyBox.X=(MyBox.X-50);
  MyBox.SetView(26);
  aExplode.Play();
  MyBox.Animate(0, 2, eOnce, eNoBlock);
  cMonty.LockView(28);
  cMonty.Animate(0, 4, eOnce, eBlock);
  MyBox.X=(MyBox.X+50);
  cMonty.LoseInventory(iSaw);
  AtticToolCount=0;
  cMonty.ChangeRoom(5);
}

function DevilPopOut(Object *MyBox, int BoxX, int BoxY)
{
  MyBox.X=(MyBox.X-200);
  MyBox.SetView(29);
  MyBox.Animate(0, 2, eOnce, eNoBlock);
  cMonty.LockView(30);
  cMonty.Animate(0, 2, eOnce, eBlock);
  MyBox.X=(MyBox.X+200);
  cMonty.LoseInventory(iDynamite);
  AtticToolCount=0;
  cMonty.ChangeRoom(5);
}
function hHotspot1_WalkOn(Hotspot *theHotspot)
{
if (AtticToolCount!=2)
{
  Display("I shant go downstairs without checking the boxes for tools");
  player.Walk(780, 630, eBlock);
}
else
{
  if (Puzzle01Stage==3)
  {
    Puzzle01Stage=4;
  }
  cMonty.LoseInventory(iExacto);
  cMonty.ChangeRoom(3, 366, 218, eDirectionRight);
}
}

function oDynomite_Interact(Object *theObject, CursorMode mode)
{
  WalkToObjectAndPickup(theObject);
  cMonty.AddInventory(iDynamite);
  AtticToolCount++;
}

function oSaw_Interact(Object *theObject, CursorMode mode)
{
  WalkToObjectAndPickup(theObject);
  cMonty.AddInventory(iSaw);
  AtticToolCount++;
}

function oTorch_Interact(Object *theObject, CursorMode mode)
{
WalkToObjectAndPickup(theObject);
cMonty.AddInventory(iTorch);
player.ActiveInventory = inventory[21];
}

function room_AfterFadeIn()
{
  sawBox=Random(5)+1;
  DynoBox=Random(5)+1;
  if (DynoBox==sawBox)
  {
    if (sawBox==6)
    {
      DynoBox=1;
    }
    else
    {
      DynoBox=sawBox+1;
    }
 //   if (DynoBox==0)
 //   {
 //     DynoBox=sawBox+1;
 //     if (DynoBox==7)
 //     {
 //       DynoBox=5;
 //     }
 //     }
 //   }
  }
//  cMonty.SayBackground(String.Format("%d", DynoBox));
}

function oBox01_Interact(Object *theObject, CursorMode mode)
{
if (sawBox==1)
{
  Display("You have found the saw");
}
else
{
  Display("No Saw for you.");
}
}

function oBox02_Interact(Object *theObject, CursorMode mode)
{
if (sawBox==2)
{
  Display("You have found the saw");
}
else
{
  Display("No Saw for you.");
}
}

function oBox03_Interact(Object *theObject, CursorMode mode)
{
if (sawBox==3)
{
  Display("You have found the saw");
}
else
{
  Display("No Saw for you.");
}
}

function oBox04_Interact(Object *theObject, CursorMode mode)
{
if (sawBox==4)
{
  Display("You have found the saw");
}
else
{
  Display("No Saw for you.");
}
}

function oBox05_Interact(Object *theObject, CursorMode mode)
{
if (sawBox==5)
{
  Display("You have found the saw");
}
else
{
  Display("No Saw for you.");
}
}

function oBox06_Interact(Object *theObject, CursorMode mode)
{
if (sawBox==6)
{
  Display("You have found the saw");
}
else
{
  Display("No Saw for you.");
}
}

function oBox06_UseInv(Object *theObject, CursorMode mode)
{
if (player.ActiveInventory.ID == 21)
{
  player.Walk(theObject.X, theObject.Y, eBlock, eWalkableAreas);
  oTorch.SetPosition(theObject.X+20, theObject.Y-30);
  oTorch.Visible=true;
  oTorch.Animate(1, 2, eRepeat, eNoBlock);
  Wait(20);
  oTorch.Visible=false;
  theObject.SetView(24);
  aFire.Play();
  //theObject.Animate(0, 3, eOnce, eBlock);
  if (sawBox==6)
  {
    oSaw.Graphic=246;
    aDemon_die.Play();
    DevilSkeleton=true;
    oSaw.X=theObject.X;
    oSaw.Y=theObject.Y;
  }
  theObject.Animate(0, 3, eOnce, eBlock);
  if (DynoBox==6)
  {
    aFuse.Play();
    oDynomite.X=theObject.X+25;
    oDynomite.Y=theObject.Y;
    ExplodeBox(theObject, theObject.X, theObject.Y);
  }
}
else if (player.ActiveInventory.ID == 22)
{
  player.Walk(theObject.X, theObject.Y, eBlock, eWalkableAreas);
  theObject.SetView(25);
  aBoxcut.Play();
  //theObject.Animate(0, 3, eOnce, eBlock);
  if (sawBox==6)
  {
    oSaw.X=theObject.X;
    oSaw.Y=theObject.Y;
    DevilPopOut(theObject, theObject.X, theObject.Y);
  }
  if (DynoBox==6)
  {
    theObject.Animate(0, 3, eOnce, eBlock);
    oDynomite.X=theObject.X+25;
    oDynomite.Y=theObject.Y;
  }
  if (DynoBox!=6 && sawBox!=6)
  {
    theObject.Animate(0, 3, eOnce, eBlock);
  }
}
}

// BOXES!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
function oBox01_UseInv(Object *theObject, CursorMode mode)
{
if (player.ActiveInventory.ID == 21)
{
  player.Walk(theObject.X, theObject.Y, eBlock, eWalkableAreas);
  oTorch.SetPosition(theObject.X+20, theObject.Y-30);
  oTorch.Visible=true;
  oTorch.Animate(1, 2, eRepeat, eNoBlock);
  Wait(20);
  oTorch.Visible=false;
  theObject.SetView(24);
  aFire.Play();
  //theObject.Animate(0, 3, eOnce, eBlock);
  if (sawBox==1)
  {
    oSaw.Graphic=246;
    aDemon_die.Play();
    DevilSkeleton=true;
    oSaw.X=theObject.X;
    oSaw.Y=theObject.Y;
  }
  theObject.Animate(0, 3, eOnce, eBlock);
  if (DynoBox==1)
  {
    aFuse.Play();
    oDynomite.X=theObject.X+25;
    oDynomite.Y=theObject.Y;
    ExplodeBox(theObject, theObject.X, theObject.Y);
  }
}
else if (player.ActiveInventory.ID == 22)
{
  player.Walk(theObject.X, theObject.Y, eBlock, eWalkableAreas);
  theObject.SetView(25);
  aBoxcut.Play();
  //theObject.Animate(0, 3, eOnce, eBlock);
  if (sawBox==1)
  {
    oSaw.X=theObject.X;
    oSaw.Y=theObject.Y;
    aDemon.Play();
    DevilPopOut(theObject, theObject.X, theObject.Y);
  }
  if (DynoBox==1)
  {
    oDynomite.X=theObject.X+25;
    oDynomite.Y=theObject.Y;
    theObject.Animate(0, 3, eOnce, eBlock);
  }
  if (DynoBox!=1 && sawBox!=1)
  {
    theObject.Animate(0, 3, eOnce, eBlock);
  }
}
}

function oBox02_UseInv(Object *theObject, CursorMode mode)
{
if (player.ActiveInventory.ID == 21)
{
  player.Walk(theObject.X, theObject.Y, eBlock, eWalkableAreas);
  oTorch.SetPosition(theObject.X+20, theObject.Y-30);
  oTorch.Visible=true;
  oTorch.Animate(1, 2, eRepeat, eNoBlock);
  Wait(20);
  oTorch.Visible=false;
  theObject.SetView(24);
  aFire.Play();
  //theObject.Animate(0, 3, eOnce, eBlock);
  if (sawBox==2)
  {
    oSaw.Graphic=246;
    aDemon_die.Play();
    DevilSkeleton=true;
    oSaw.X=theObject.X;
    oSaw.Y=theObject.Y;
  }
  theObject.Animate(0, 3, eOnce, eBlock);
  if (DynoBox==2)
  {
    aFuse.Play();
    oDynomite.X=theObject.X+25;
    oDynomite.Y=theObject.Y;
    ExplodeBox(theObject, theObject.X, theObject.Y);
  }
}
else if (player.ActiveInventory.ID == 22)
{
  player.Walk(theObject.X, theObject.Y, eBlock, eWalkableAreas);
  theObject.SetView(25);
  aBoxcut.Play();
  //theObject.Animate(0, 3, eOnce, eBlock);
  if (sawBox==2)
  {
    oSaw.X=theObject.X;
    oSaw.Y=theObject.Y;
    aDemon.Play();
    DevilPopOut(theObject, theObject.X, theObject.Y);
  }
  if (DynoBox==2)
  {
    oDynomite.X=theObject.X+25;
    oDynomite.Y=theObject.Y;
    theObject.Animate(0, 3, eOnce, eBlock);
  }
  if (DynoBox!=2 && sawBox!=2)
  {
    theObject.Animate(0, 3, eOnce, eBlock);
  }
}
}

function oBox03_UseInv(Object *theObject, CursorMode mode)
{
if (player.ActiveInventory.ID == 21)
{
  player.Walk(theObject.X, theObject.Y, eBlock, eWalkableAreas);
  oTorch.SetPosition(theObject.X+20, theObject.Y-30);
  oTorch.Visible=true;
  oTorch.Animate(1, 2, eRepeat, eNoBlock);
  Wait(20);
  oTorch.Visible=false;
  theObject.SetView(24);
  aFire.Play();
  //theObject.Animate(0, 3, eOnce, eBlock);
  if (sawBox==3)
  {
    oSaw.Graphic=246;
    aDemon_die.Play();
    DevilSkeleton=true;
    oSaw.X=theObject.X;
    oSaw.Y=theObject.Y;
  }
  theObject.Animate(0, 3, eOnce, eBlock);
  if (DynoBox==3)
  {
    aFuse.Play();
    oDynomite.X=theObject.X+25;
    oDynomite.Y=theObject.Y;
    ExplodeBox(theObject, theObject.X, theObject.Y);
  }
}
else if (player.ActiveInventory.ID == 22)
{
  player.Walk(theObject.X, theObject.Y, eBlock, eWalkableAreas);
  theObject.SetView(25);
  aBoxcut.Play();
  //theObject.Animate(0, 3, eOnce, eBlock);
  if (sawBox==3)
  {
    oSaw.X=theObject.X;
    oSaw.Y=theObject.Y;
    aDemon.Play();
    DevilPopOut(theObject, theObject.X, theObject.Y);
  }
  if (DynoBox==3)
  {
    oDynomite.X=theObject.X+25;
    oDynomite.Y=theObject.Y;
    theObject.Animate(0, 3, eOnce, eBlock);
  }
  if (DynoBox!=3 && sawBox!=3)
  {
    theObject.Animate(0, 3, eOnce, eBlock);
  }
}
}

function oBox05_UseInv(Object *theObject, CursorMode mode)
{
if (player.ActiveInventory.ID == 21)
{
  player.Walk(theObject.X, theObject.Y, eBlock, eWalkableAreas);
  oTorch.SetPosition(theObject.X+20, theObject.Y-30);
  oTorch.Visible=true;
  oTorch.Animate(1, 2, eRepeat, eNoBlock);
  Wait(20);
  oTorch.Visible=false;
  theObject.SetView(24);
  aFire.Play();
  //theObject.Animate(0, 3, eOnce, eBlock);
  if (sawBox==5)
  {
    oSaw.Graphic=246;
    aDemon_die.Play();
    DevilSkeleton=true;
    oSaw.X=theObject.X;
    oSaw.Y=theObject.Y;
  }
  theObject.Animate(0, 3, eOnce, eBlock);
  if (DynoBox==5)
  {
    aFuse.Play();
    oDynomite.X=theObject.X+25;
    oDynomite.Y=theObject.Y;
    ExplodeBox(theObject, theObject.X, theObject.Y);
  }
}
else if (player.ActiveInventory.ID == 22)
{
  player.Walk(theObject.X, theObject.Y, eBlock, eWalkableAreas);
  theObject.SetView(25);
  aBoxcut.Play();
  //theObject.Animate(0, 3, eOnce, eBlock);
  if (sawBox==5)
  {
    oSaw.X=theObject.X;
    oSaw.Y=theObject.Y;
    aDemon.Play();
    DevilPopOut(theObject, theObject.X, theObject.Y);
  }
  if (DynoBox==5)
  {
    oDynomite.X=theObject.X+25;
    oDynomite.Y=theObject.Y;
    theObject.Animate(0, 3, eOnce, eBlock);
  }
  if (DynoBox!=5 && sawBox!=5)
  {
    theObject.Animate(0, 3, eOnce, eBlock);
  }
}
}

function oBox04_UseInv(Object *theObject, CursorMode mode)
{
if (player.ActiveInventory.ID == 21)
{
  player.Walk(theObject.X, theObject.Y, eBlock, eWalkableAreas);
  oTorch.SetPosition(theObject.X+20, theObject.Y-30);
  oTorch.Visible=true;
  oTorch.Animate(1, 2, eRepeat, eNoBlock);
  Wait(20);
  oTorch.Visible=false;
  theObject.SetView(24);
  aFire.Play();
  //theObject.Animate(0, 3, eOnce, eBlock);
  if (sawBox==4)
  {
    oSaw.Graphic=246;
    aDemon_die.Play();
    DevilSkeleton=true;
    oSaw.X=theObject.X;
    oSaw.Y=theObject.Y;
  }
  theObject.Animate(0, 3, eOnce, eBlock);
  if (DynoBox==4)
  {
    aFuse.Play();
    oDynomite.X=theObject.X+25;
    oDynomite.Y=theObject.Y;
    ExplodeBox(theObject, theObject.X, theObject.Y);
  }
}
else if (player.ActiveInventory.ID == 22)
{
  player.Walk(theObject.X, theObject.Y, eBlock, eWalkableAreas);
  theObject.SetView(25);
  aBoxcut.Play();
  //theObject.Animate(0, 3, eOnce, eBlock);
  if (sawBox==4)
  {
    oSaw.X=theObject.X;
    oSaw.Y=theObject.Y;
    aDemon.Play();
    DevilPopOut(theObject, theObject.X, theObject.Y);
  }
  if (DynoBox==4)
  {
    oDynomite.X=theObject.X+25;
    oDynomite.Y=theObject.Y;
    theObject.Animate(0, 3, eOnce, eBlock);
  }
  if (DynoBox!=4 && sawBox!=4)
  {
    theObject.Animate(0, 3, eOnce, eBlock);
  }
}
}

function oObject0_Interact(Object *theObject, CursorMode mode)
{
WalkToObjectAndPickup(theObject);
cMonty.AddInventory(iExacto);
player.ActiveInventory = inventory[22];
}

function room_Load()
{
  oTorch.SetView(41, 0);
  oTorch.Animate(0, 2, eRepeat, eNoBlock);
  if (Puzzle01Stage<4)
  {
    cMonty.ChangeView(2);
    oBox01.Graphic=177;
    oBox02.Graphic=177;
    oBox03.Graphic=177;
    oBox04.Graphic=177;
    oBox05.Graphic=177;
    oBox06.Graphic=177;
    oSaw.X=-100;
    oSaw.SetView(31);
    oDynomite.X=-100;
    oDynomite.SetView(32);
  }
}

function room_RepExec()
{
if (RunDevilDust==true)
{
  RunDevilDust=false;
  oSaw.SetView(33);
  oSaw.Animate(0, 2, eOnce, eBlock);
}
 //exec 6 (all the stuff to autochange the cursor
 Object *hoveredObject = Object.GetAtScreenXY(mouse.x, mouse.y);
 Character *hoveredChar = Character.GetAtScreenXY(mouse.x, mouse.y);
 GUI *hoveredGUI = GUI.GetAtScreenXY(mouse.x, mouse.y);
 //nil
 if (gInventory.Visible || gHelpGUI01.Visible || gHelpGUI02.Visible || gHelpGUI03.Visible)
  {
  }
 else
 {
 if (mouse.Mode!=4)
 {
   if (hoveredObject == null && hoveredChar == null && hoveredGUI==null)
   {
     mouse.Mode=0;
   }
   else if (hoveredObject != null)
   {
     String description = hoveredObject.GetTextProperty("Description");
     if (description == "Puzzle")
     {
       mouse.Mode=1;
     }
     else if (description == "Pickup")
     {
       mouse.Mode=2;
     }
   }
   else if (hoveredChar!=null)
   {
     String description = hoveredChar.GetTextProperty("Description");
     if (description == "Character")
     {
       mouse.Mode=3;
     }
   }
 }
 }
}
