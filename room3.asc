// room script file

function sendInTheFriends()
{
  if (PuzzleNum==4)
  {
    cMonty.Walk(620, 692, eNoBlock, eWalkableAreas);
    cGhosty.x=1228;
    cGhosty.y=560;
    cGhosty.Walk(408, 560, eNoBlock, eWalkableAreas);
    Wait(10);
    cOcty.x=1228;
    cOcty.y=560;
    cOcty.Walk(654, 506, eNoBlock, eWalkableAreas);
    Wait(10);
    cBuzzy.x=1228;
    cBuzzy.y=560;
    cBuzzy.Walk(854, 568, eBlock, eWalkableAreas);
    Display("Happy Birthday Monty!");
  }
}

function ResetBalloons()
{
  oEyeBalloons.X=258;
  oEyeBalloons.Y=468;
}

function RaiseBalloons()
{
  while (oEyeBalloons.Y>390)
  {
    oEyeBalloons.Y=oEyeBalloons.Y-2;
    Wait(1);
  }
  aCat.Play();
  cCat.Walk(24, 175, eBlock, eAnywhere);
}

function oSpoon_Interact(Object *theObject, CursorMode mode)
{
//SayTypewriterStyle(cMonty, "hey I'm talking like a typewriter", 2);
WalkToObjectAndPickupTall(theObject);
cMonty.AddInventory(iSpoon);
}

function oSaw_Interact(Object *theObject, CursorMode mode)
{
WalkToObjectAndPickup(theObject);
cMonty.AddInventory(iSaw);
}

function room_RepExec()
{
 // exec 0 (spoon sound) 
 // exec 1
 if (cHuman01.Animating && cHuman01.View == 5)
 {
   if (cHuman01.Loop == 0 && cHuman01.Frame == 1)
   {
     aSquirt.Play();
   }  
 }
 // exec 2
 if(EyeballAnim==true)
 {
   EyeballAnim=false;
   oEyefall.Visible=true;
   oEyefall.SetView(15);
   oEyefall.Animate(0, 3, eOnce, eBlock);
   oEyeballs.Visible=true;
   oEyefall.Visible=false;
 }
 //exec 3
 //if ((Puzzle01Stage==2 || Puzzle01Stage==3 || Puzzle01Stage==4) && cHuman01.y ==HumanWalkAY)
 //{
 //  cHuman01.Walk(1032, 677, eNoBlock, eAnywhere);
 //  HumWalkUp=2;
 //}
 //exec 4
 //if ((Puzzle01Stage==2 || Puzzle01Stage==3 || Puzzle01Stage==4) && cHuman01.y>670)
 //{
 //  cHuman01.Walk(HumanWalkAX, HumanWalkAY, eNoBlock, eAnywhere);
 //  HumWalkUp=1;
 //}
 //exec 5
 if (HeadRoll==true)
 {
   HeadRoll=false;
   oHeadRoll.SetView(17);
   oHeadRoll.SetPosition(cHuman01.x, cHuman01.y);
   oHeadRoll.Animate(0, 3, eOnce, eBlock);
   oHead.SetPosition(oHeadRoll.X+125, oHeadRoll.Y);
   oHeadRoll.Visible=false;
 }
 //exec 6 (all the stuff to autochange the cursor
 Object *hoveredObject = Object.GetAtScreenXY(mouse.x, mouse.y);
 Character *hoveredChar = Character.GetAtScreenXY(mouse.x, mouse.y);
 GUI *hoveredGUI = GUI.GetAtScreenXY(mouse.x, mouse.y);
 //nil
 if (gInventory.Visible || gHelpGUI01.Visible || gHelpGUI02.Visible || gHelpGUI03.Visible)
  {
  }
 else
 {
 if (mouse.Mode!=4)
 {
   if (hoveredObject == null && hoveredChar == null && hoveredGUI==null)
   {
     mouse.Mode=0;
   }
   else if (hoveredObject != null)
   {
     String description = hoveredObject.GetTextProperty("Description");
     if (description == "Puzzle")
     {
       mouse.Mode=1;
     }
     else if (description == "Pickup")
     {
       mouse.Mode=2;
     }
     if (Object.GetAtScreenXY(mouse.x, mouse.y) == oFrontDoor)
     {
       mouse.Mode=2;
     }
   }
   else if (hoveredChar!=null)
   {
     String description = hoveredChar.GetTextProperty("Description");
     if (description == "Character")
     {
       mouse.Mode=3;
     }
     else if (description == "Pickup")
     {
       mouse.Mode=2;
     }
   }
 }
 }
 //exec7 legs run through boards
 if (cHuman01.IsCollidingWithObject(oBoardsL)==1 || cHuman01.IsCollidingWithObject(oBoardsR)==1)
 {
   aCrash.Play(eAudioPriorityHigh);
   oWoodBreak.SetPosition(2, 600);
   oWoodBreak.SetView(34);
   oWoodBreak.Animate(0, 2, eOnce, eNoBlock);
   oBoardsL.Graphic=259;
   oBoardsR.Graphic=260;
   RestoreWalkableArea(5);
   cHuman01.Walk(0, 546, eBlock);
   cHuman01.ChangeRoom(4, 380, 1382, eDirectionLeft);
 }
 if (ShouldExplode==true)
 {
   if (Puzzle01Stage<4)
   {
   ShouldExplode=false;
   cMonty.x=cHuman01.x-40;
   cMonty.y=cHuman01.y-20;
   cHuman01.LockView(52);
   cHuman01.Animate(0, 1, eRepeat, eNoBlock);
   cMonty.LockView(53);
   cMonty.Animate(0, 3, eOnce, eBlock);
   Wait(50);
   cHuman01.LockView(16);
   cMonty.x=270;
   cMonty.y=633;
   cMonty.UnlockView();
   cMonty.LoseInventory(iHeliumTank);
   oHeliumTank.Visible=true;
   oHeliumTank.SetPosition(1127, 519);
   HumanWalkAX=970;
   HumanWalkAY=533;
   HumanWalkBX=1150;
   HumanWalkBY=666;
   cHuman01.Walk(HumanWalkBX, HumanWalkBY, eNoBlock, eAnywhere);
   cCat.x=358;
   cCat.y=222;
   oAtticDoor.SetView(49, 0, 0);
   IsAtticDoorOpen=false;
   
   if (oEyeBalloons.Graphic==73)
   {
     Puzzle01Stage = 2;
     oEyeBalloons.Graphic=72;
     cMonty.AddInventory(iEyes);
     ResetBalloons();
   }
   if (cMonty.HasInventory(iEyeBalloons))
   {
     cMonty.LoseInventory(iEyeBalloons);
     cMonty.AddInventory(iEyes);
   }
   }
   else
   {
     ShouldExplode=false;
     cMonty.LockView(28);
     cMonty.Animate(0, 3, eOnce, eBlock);
     cMonty.x=332;
     cMonty.y=210;
     cMonty.UnlockView();
   }
   
 }
 //if (cHuman01.IsCollidingWithChar(cMonty))// && cHuman01.y>cMonty.y && HumWalkUp==1)
 //{
   //QuitGame(1);
 //  cMonty.LockView(28);
 //  cMonty.Animate(0, 3, eOnce, eBlock);
 //  cMonty.x=270;
 //  cMonty.y=633;
 //  cMonty.UnlockView();
 //  cMonty.LoseInventory(iHeliumTank);
 //  oHeliumTank.Visible=true;
 //  oHeliumTank.SetPosition(1127, 519);
// }
}

function repeatedly_execute_always()
{
if (cHuman01.IsCollidingWithChar(cMonty) && cHuman01.View==16 && cMonty.View==2 && cMonty.ActiveInventory!=iSaw)// && cHuman01.y>cMonty.y && HumWalkUp==1)
 {
   //QuitGame(1);
   cMonty.LockView(28);
   ShouldExplode=true;
   //cMonty.LockView(28);
   //cMonty.Animate(0, 3, eOnce, eNoBlock);
   //cMonty.x=270;
   //cMonty.y=633;
   //cMonty.UnlockView();
   //cMonty.LoseInventory(iHeliumTank);
   //oHeliumTank.Visible=true;
   //oHeliumTank.SetPosition(1127, 519);
 }
if ((Puzzle01Stage==2 || Puzzle01Stage==3 || Puzzle01Stage==4) && cHuman01.y ==HumanWalkAY)
 {
   cHuman01.Walk(HumanWalkBX, HumanWalkBY, eNoBlock, eAnywhere);
   HumWalkUp=2;
 }
 //exec 4
if ((Puzzle01Stage==2 || Puzzle01Stage==3 || Puzzle01Stage==4) && cHuman01.y==HumanWalkBY)
 {
   cHuman01.Walk(HumanWalkAX, HumanWalkAY, eNoBlock, eAnywhere);
   HumWalkUp=1;
 }
 if (cCat.x<oAtticDoor.X+70)
 {
   if (IsAtticDoorOpen==false)
   {
   IsAtticDoorOpen=true;
   oAtticDoor.SetView(49);
   oAtticDoor.Animate(0, 2, eOnce, eNoBlock);
   }
 }
}

function room_AfterFadeIn()
{
  if (Puzzle01Stage<2)
  {
    oEyeballs.Visible=false;
    oEyefall.Visible=false;
  }
  if (Puzzle01Stage<7)
  {
    RemoveWalkableArea(5);
  }
  if (DoorUp != true)
  {
    RemoveWalkableArea(4);
    RemoveWalkableArea(5);
  }
  confettiobj = oConfetti;
  //BackgroundMusic = aSpookybackground01.Play();
  //BackgroundMusic.Volume =50;
  //AudioChannel *channel = aSpookybackground01.Play();
  //channel.Volume = 50;
}

function oHeliumTank_Interact(Object *theObject, CursorMode mode)
{
  if (Puzzle01Stage == 2)
  {
   WalkToObjectAndPickup(theObject);
   cMonty.AddInventory(iHeliumTank);
  }
  else if (Puzzle01Stage == 0)
  {
    cHuman01.Say("Yo, talk to me first, bud.");
  }
  else if (Puzzle01Stage == 1)
  {
   cHuman01.Say("Sign here first, Greenface.");
  }
}

function oDynamite_Interact(Object *theObject, CursorMode mode)
{
  WalkToObjectAndPickup(theObject);
  cMonty.AddInventory(iDynamite);
}

function oMeatGrinder_Interact(Object *theObject, CursorMode mode)
{
  WalkToObjectAndPickup(theObject);
  cMonty.AddInventory(iMeatGrinder);
}

function oObject2_UseInv(Object *theObject, CursorMode mode)
{
if (player.ActiveInventory == iIntestine)
  {
    cMonty.Walk(295, 195, eBlock, eWalkableAreas);
    cMonty.LockView(43);
    cMonty.Animate(0, 3, eOnce, eBlock);
    oStreamersGrey.Graphic = 71;
    cMonty.LoseInventory(iIntestine);
    aReward.Play();
    oConfetti.X = theObject.X-50;
    oConfetti.Y = theObject.Y+50;
    oConfetti.SetView(14);
    oConfetti.Animate(0, 5, eOnce, eNoBlock);
    cMonty.UnlockView();
    cMonty.Animate(1, 3, eOnce, eNoBlock);
    PuzzleNum++;
    sendInTheFriends();
    cMonty.UnlockView();
  }
}

function oEyeBalloons_UseInv(Object *theObject, CursorMode mode)
{
if (player.ActiveInventory == iEyeBalloons)
  {
    cMonty.Walk(theObject.X+125, theObject.Y+100, eBlock);
    oEyeBalloons.Graphic = 73;
    cMonty.LoseInventory(iEyeBalloons);
    Puzzle01Stage = 3;
    String puzzlestage = String.Format("Stage: %d", Puzzle01Stage);
    //LabelPuzzleStage.Text = puzzlestage;
    aReward.Play();
    oConfetti.X = theObject.X-50;
    oConfetti.Y = theObject.Y+50;
    oConfetti.SetView(14);
    oConfetti.Animate(0, 5, eOnce);
    PuzzleNum++;
    sendInTheFriends();
    RaiseBalloons();
    //make human walk to block stairs
    HumanWalkAX=650;
    HumanWalkAY=525;
    HumanWalkBX=1040;
    HumanWalkBY=582;
    cHuman01.Walk(HumanWalkAX, HumanWalkAY, eNoBlock, eAnywhere);
  }
}

function oObject2_Interact(Object *theObject, CursorMode mode)
{
  WalkToObjectAndPickup(theObject);
  cMonty.AddInventory(iBread);
}

function oBurgers_UseInv(Object *theObject, CursorMode mode)
{
if (player.ActiveInventory == iBurgers)
  {
    cMonty.Walk(theObject.X, theObject.Y);
    oBurgers.Graphic = 77;
    cMonty.LoseInventory(iBurgers);
    aReward.Play();
    oConfetti.X = theObject.X-50;
    oConfetti.Y = theObject.Y+50;
    oConfetti.SetView(14);
    oConfetti.Animate(0, 5, eOnce);
    PuzzleNum++;
    sendInTheFriends();
  }
}

function oCandles_Interact(Object *theObject, CursorMode mode)
{
  WalkToObjectAndPickupTall(theObject);
  cMonty.AddInventory(iCandles);
}

function oHeadCandles_UseInv(Object *theObject, CursorMode mode)
{
if (player.ActiveInventory == iSkullCandles)
  {
    cMonty.Walk(theObject.X, theObject.Y, eBlock, eWalkableAreas);
    oHeadCandles.Graphic = 302;
    oHeadCandles.SetView(45);
    oHeadCandles.Animate(0, 2, eRepeat, eNoBlock);
    cMonty.LoseInventory(iSkullCandles);
    aReward.Play();
    oConfetti.X = theObject.X-50;
    oConfetti.Y = theObject.Y+50;
    oConfetti.SetView(14);
    oConfetti.Animate(0, 5, eOnce);
    Wait(20);
    aFire.Play();
    oShelf.SetView(44);
    oShelf.Animate(0, 3, eOnce, eBlock);
    int TimerY = oClock.Y + 300; // Make Clock fall to floor
    while (oClock.Y < TimerY)
      {
        oClock.Y += 10;              // Move object up by 1 pixel
        Wait(1);                  // Pause for a short time to make the movement smooth
      }
    CanGetTimer=true;
    PuzzleNum++;
    sendInTheFriends();
  }
 else if (player.ActiveInventory==iHeadCandles)
 {
   cMonty.Think("Hmm, these candles aren't lit yet.");
   Mouse.Mode=2;
 }
}

function oStreamersGrey_Look(Object *theObject, CursorMode mode)
{
 if (theObject.Graphic == 70)
 {
   player.Say("I need to find something long and pretty to hang from the walls.");
 }
}

function oEyeBalloons_Look(Object *theObject, CursorMode mode)
{
 if (theObject.Graphic == 72)
 {
   player.Say("I could probably use helium on any round things to create balloons...");
 }
}

function oSpoon_Look(Object *theObject, CursorMode mode)
{
  player.Say("The pen is mightier than the... uh... what was I thinking?");
}

function oSaw_Look(Object *theObject, CursorMode mode)
{
player.Say("An old rusty saw. For sawing heads off, perhaps?");
}

function oCandles_Look(Object *theObject, CursorMode mode)
{
player.Say("Gotta jab these candles into something hole-y");
}

function oHeliumTank_Look(Object *theObject, CursorMode mode)
{
player.Say("Helium! Can turn most round things into balloons right?");
}

function oObject2_Look(Object *theObject, CursorMode mode)
{
player.Say("Bread is good for sandwhiches to feed my friends.");
}

function oMeatGrinder_Look(Object *theObject, CursorMode mode)
{
player.Say("A meat grinder! To grind 'meat'. For Sandwhiches!");
}

function oHeadCandles_Look(Object *theObject, CursorMode mode)
{
player.Say("A candle centerpiece will delight my friends.");
}

function oBurgers_Look(Object *theObject, CursorMode mode)
{
player.Say("Must make 'burgers' before my friends arrive...");
}

function oDynamite_Look(Object *theObject, CursorMode mode)
{
player.Say("Dy-No-MITE! Maybe I can blow something (or someONE) up with this.");
}

function oFrontDoor_Interact(Object *theObject, CursorMode mode)
{
  if (oFrontDoor.Y > 500)
  {
    cMonty.Walk(oFrontDoor.X, oFrontDoor.Y, eBlock, eWalkableAreas);
    aOpenDoor.Play();
    int finalY = oFrontDoor.Y - 200;  // Raise the object by 50 pixels
    while (oFrontDoor.Y > finalY)
      {
        oFrontDoor.Y -= 5;              // Move object up by 1 pixel
        Wait(1);                  // Pause for a short time to make the movement smooth
      }
     DoorUp=true;
     RestoreWalkableArea(4);
  }
  //if (oFrontDoor.Frame == 0)
  //{
  //  oFrontDoor.SetView(10);
    //oFrontDoor.Animate(0, 1, eOnce,  eBlock);
    //oFrontDoor.Baseline = 560;
  //}
  //else if (oFrontDoor.Frame == 7)
  //{
  //  oFrontDoor.Baseline = 560;
  //  oFrontDoor.SetView(10);
  //  oFrontDoor.Animate(0, 1, eOnce,  eNoBlock, eBackwards);
  //}
}

function oBackgroundMusic_Interact(Object *theObject, CursorMode mode)
{
  BackgroundMusic.Pause();
}

function hKitchen_WalkOn(Hotspot *theHotspot)
{
 if (Puzzle01Stage > 2)
 {
  player.ChangeRoom(4,  1050, 1382);
 }
 else
 {
   player.SayBackground("I need to get my helium first.");
 }
}

function oFrontDoor_Look(Object *theObject, CursorMode mode)
{
player.Say("Do I hear a knock at the door?");
}

function hKitchen_AnyClick(Hotspot *theHotspot, CursorMode mode)
{
}

function hHotAttic_WalkOn(Hotspot *theHotspot)
{
if (Puzzle01Stage > 2)
{
  cMonty.ChangeRoom(5, 600, 575, eDirectionLeft);
}
else
{
  Display("I should take care of the balloons before going up to get my 'tools'...");
  player.Walk(630, 300, eBlock);
  //player.SayBackground("I shouldn't go to the attic yet.");
}
}

function room_FirstLoad()
{
Game.SpeechFont = eFontSuperComic;
oEyeballs.Visible=false;
  oEyefall.Visible=false;
  mouse.Mode=2;
}

function room_Load()
{
  oEyeballs.Visible=false;
  oEyefall.Visible=false;
  if (Puzzle01Stage==2 || Puzzle01Stage==3 || Puzzle01Stage==4)
  {
    cHuman01.Walk(HumanWalkAX, HumanWalkAY, eNoBlock);
  }
}

function oEyeballs_Interact(Object *theObject, CursorMode mode)
{
  WalkToObjectAndPickup(theObject);
  cMonty.AddInventory(iEyes);
}

function oHead_Interact(Object *theObject, CursorMode mode)
{
  WalkToObjectAndPickup(theObject);
  cMonty.AddInventory(iHead);
}

function oClock_Interact(Object *theObject, CursorMode mode)
{
if (CanGetTimer==true)
{
  WalkToObjectAndPickup(theObject);
  cMonty.AddInventory(iTimer);
}
else
{
  cMonty.Think("It's too high for me to reach... right now.");
}
}
